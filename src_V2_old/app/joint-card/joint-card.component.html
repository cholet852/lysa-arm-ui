<div class="card">
  <div class="header">
    <h3>{{title}}</h3>
    <div class="badges">
      <span class="badge ok"   *ngIf="s?.flags?.ok">OK</span>
      <span class="badge warn" *ngIf="s?.flags?.openLoad">OpenLoad</span>
      <span class="badge warn" *ngIf="s?.flags?.otw">OTW</span>
      <span class="badge err"  *ngIf="s?.flags?.ot">OT</span>
    </div>
  </div>

  <!-- Angle -->
  <div class="row">
    <label>Angle</label>
    <input type="number" [(ngModel)]="targetDeg"
      (focusin)="editing.angle=true"
      (blur)="editing.angle=false; commitAngle()"
      (keyup.enter)="commitAngle()"/>

    <button (click)="bump(-90)">-90°</button>
    <button (click)="bump(-45)">-45°</button>
    <button (click)="bump(-10)">-10°</button>
    <button (click)="bump(-5)">-5°</button>

    <!-- Le slider envoie une seule fois quand tu relâches -->
    <input type="range" min="-180" max="180" [(ngModel)]="targetDeg"
      (mousedown)="startAngleSlider()"
      (touchstart)="startAngleSlider()"
      (input)="onAngleSliderInput()"
      (mouseup)="endAngleSlider()"
      (touchend)="endAngleSlider()"
      (change)="endAngleSlider()"/>

    <button (click)="bump(5)">+5°</button>
    <button (click)="bump(10)">+10°</button>
    <button (click)="bump(45)">+45°</button>
    <button (click)="bump(90)">+90°</button>
  </div>

  <!-- Speed / Accel -->
  <div class="row">
    <label>Speed (deg/s)</label>
    <input type="number" [(ngModel)]="speed"
      (focusin)="editing.speed=true"
      (blur)="editing.speed=false; commitSpeed()"
      (keyup.enter)="commitSpeed()"/>

    <label>Accel (deg/s²)</label>
    <input type="number" [(ngModel)]="accel"
      (focusin)="editing.accel=true"
      (blur)="editing.accel=false; commitAccel()"
      (keyup.enter)="commitAccel()"/>
  </div>

  <!-- Current / Micro -->
  <div class="row">
    <label>Current (mA)</label>
    <input type="number" [(ngModel)]="current"
      (focusin)="editing.current=true"
      (blur)="editing.current=false; commitCurrent()"
      (keyup.enter)="commitCurrent()"/>

    <label>Microsteps</label>
    <select [(ngModel)]="micro"
      (focusin)="editing.micro=true"
      (blur)="editing.micro=false"
      (change)="commitMicro()">
      <option *ngFor="let u of micros" [value]="u">{{u}}</option>
    </select>
  </div>

  <div class="row small">
    <div>Now: <b>{{ s?.angle  | number:'1.0-1' }}°</b></div>
    <div>Target:   {{ s?.target | number:'1.0-1' }}°</div>
  </div>

  <div class="row">
    <button (click)="send('home',{})">Home</button>
    <button (click)="send('reset',{})">Reset</button>
  </div>
</div>

